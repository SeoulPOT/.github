# DA

<details>
  <summary><h2>🏠 공간 테마 분류 </h2></summary>

### <mark>🎯 목적</mark>

**테마별 공간 분류**
> 사용자가 서울을 관광하기 원하는 형태, 목적에 따라 공간을 이용할 수 있도록 분류함
>
> 가장 일반적으로 수요가 있는 관광 테마를 고려하여 '가족, 연인, 혼놀, 인테리어, 반려동물, 로컬애용, 트렌드, 힐링, 가성비' 이와 같은 9개의 테마를 선정함.

**추천 서비스**
> 테마별 적합성과 긍정성을 바탕으로 공간을 추천함

**성능 개선**
> 기존 2ND AGILE 당시 개발했던 알고리즘을 기반으로 분석 수행 -> 근거를 찾아 로직에 대한 타당성을 높이며 성능 개선을 하고자함.


<br/>

### <mark>💾 데이터</mark>
**약 2,500,000개의 사용자 공간 리뷰 데이터**, 
**약 130,000개의 공간 데이터**

<br/>

### <mark>📃 과정</mark>

<p align="center">
<img src="https://github.com/user-attachments/assets/3c28f8b3-3807-4c3d-97e5-29de8b7ef1bc"/>
</p>


<br/>

**① 리뷰 데이터 준비**

> SENTIMENT 라벨링 리뷰 데이터 준비, 가게 태그 데이터 준비

<br/>

**② 리뷰 전처리**

> 테마 분류에 유의미한 단어들을 선별하기 위해 불용어 처리 및 형태소 분석(어근 및 명사)
- 한국어 텍스트 분석에서 빈번히 사용되는 감탄사, 수식어, 불필요한 장소나 시간 등 학습에 불필요한 단어를 배제하여 핵심 내용 추출을 돕기 위함
- 특정 음식명과 감정 표현도 포함해 리뷰의 주관적 요소를 제거하여 일관성 있는 텍스트 분석이 가능하게 함

<br/>

> 테마 분류 키워드 사전(CATEGORY_KEYWORDS) 정의
1. 기존에 사용하던 키워드 사전에서 각 카테고리별로 키워드가 가장 많이 언급된 10개의 가게 추출
2. 추출한 가게의 리뷰 중 키워드가 언급된 리뷰 비율 확인
3. 가게마다 리뷰 1000개씩 랜덤 추출해서 샘플링
4. 형태소 분석
5. 테마별 토큰 상위 100개 확인
6. 여러 테마에서 중복되는 토큰들을 불용어에 추가
7. 여러 키워드에서 중복되는 토큰이 줄어들 때 까지 반복
8. 중복이 제거 된 토큰들 중 테마별로 유의미한 키워드 선정

<p align="center">
<img src="https://github.com/user-attachments/assets/a84aea9c-725d-4222-a97c-364b39859fb5"/>
</p>


<br/>
<br/>
<br/>

**③ 리뷰 TF-IDF 계산**

<p align="center">
<img src="https://github.com/user-attachments/assets/53311ead-b392-49f5-a47c-859c753cc087" width="400" height="200" />
</p>

1. 데이터 관련 기존 로직 : 시간 단축 상 TF-IDF 자체를 긍정의 리뷰들만 계산

  **❗ 문제점** : 전체 리뷰에서 나타나는 단어의 빈도수가 정확히 파악되지 않음

  **💡 해결방안** : 리뷰 전처리 정교화를 통해 토큰 개수 감소로 시간 단축 -> 전체 단어로 TF-IDF 진행하여 로직 정확도 증가

<br/>

2. 파라미터 관련 기존 로직 : 태그데이터 및 전체 가게 리뷰 합친 후 TF-IDF 계산

  **❗ 문제점** : 예를 들어 가중치가 가게별로 세지는 게 아니라 전체 데이터에서 "깔끔"이 몇개 뜨는지에 따라 해당 계산값으로 가중치 적용

  **💡 해결방안** : 가게별로 나눠서 벡터화 진행 및 역수 취해서 계산 수정

<p align="center">
  <img src="https://github.com/user-attachments/assets/49f3094f-f49f-43b9-bd48-5a70bc5a3abd" width="400" height="300" />
  <img src="https://github.com/user-attachments/assets/7af235b7-a14c-469b-9ec4-e4f539e06776" width="400" height="300" />
</p>


 
<br/>
<br/>
<br/>


**④ 가게 태그 인원수 계산**
1. 네이버에서 지정한 69개의 place_feature 종류 중 테마와 관련된 요소들 추출하여 FEATURE_DICTIONARY 정의
2. 태그 인원수 가중치 = 해당 테마 태그 수/9개 테마에 해당하는 전체 태그수
> 단위값 선정 이유(9개 테마에 해당하는 전체 태그수) :
 - 리뷰 개수의 경우 텍스트 리뷰도 있고, 키워드만 택한 인원 역시 포함 안됨.
 - place_feature 다 더한 값을 전체로 하기에는 중복이 가능한 경우였으며, 맛에 대한 태그가 매우 높은 비율을 차지하기에 테마 분류       가중치로 타당하지 않을 것 같음

<br/>
<br/>
<br/>


**⑤ SENTIMENT에 따른 필터링**

기존 로직 : 감정 파라미터 필터링은 점수가 0.9로 강한 긍정 점수를 띄는 가게들만 분류 알고리즘에 넣었음 

**❗ 문제점** : 임의의 파라미터 임계값 지정 + 로직 시간 단축의 이유로 정확한 기준 특정하지 못한 것

**💡 해결방안** : 분류 정확도 증가로 감정 파라미터값 0.8로 완화 후 필터링하여 알고리즘 진행 

<br/>
<br/>
<br/>

**⑥ 가게 당 테마 비율 계산**
> place_feature 랑 tf/idf 정도 튜닝하기

각 가중치는 독립적으로 돌아가고 weight는 상대적으로 계산되기 때문에 두 파라미터 간에 스케일 조정이 필요없다고 판단.
 
<br/>
<br/>
<br/>

**⑦ 테마 비율 정확도 필터링**
> 가게마다 해당 테마를 띄는 비율의 분포를 본 결과

<p align="center">
<img src="https://github.com/user-attachments/assets/fe5bf104-9220-4c95-b846-0713803dff24"/>
</p>

대게 0~20% 에 몰려있음

<br/>
 
> 퍼센트 별로 장소들이 해당 테마를 표현하는지 분석해 본 결과 (20~30%)

<p align="center">
<img src="https://github.com/user-attachments/assets/3b97e298-a373-4298-be14-5937e181157a"/>
</p>

대표성을 띄는 장소라고 판단하기에는 명확한 근거가 없는 가게들이 포함되어 있어 30% 이상으로 테마 분류 선정

<br/>
<br/>
<br/>

**⑧ 테마 라벨링**

**❗ 문제점** : 분류되는 데이터가 매우 적음 (13만개 중 1500개)

**💡 해결방안** : 각 가중치에 대한 타당성 증가로 전반적인 필터 기준을 완화할 수 있었음 → 테마에 적합한 가게 수 증가
> 13018 장소 중 4780 장소 테마 분류됨
>
> 가족 : 1030
> 
> 연인 : 980
> 
> 혼놀 : 261
> 
> 반려동물 : 3
> 
> 트렌드 : 645
> 
> 힐링: 29
> 
> 로컬애용: 193
> 
> 감성: 175
> 
> 가성비: 2434 

<p align="center">
<img src="https://github.com/user-attachments/assets/9b2b5019-6360-48cb-95fb-625f766742de"/>
</p>


<br/>

### <mark> 추가 분석 사항</mark>

**길이 가중치 분석**
> 리뷰 길이와 감정 점수 간의 상관관계 - 0.09로 유의미하지 않다고 판단됨
>
> 불용어 제거 후 리뷰의 평균 단어가 5개, 75%가 7개 이하인 것으로 확 함으로써 길이로 리뷰의 정확성을 판단하는 것은 단어 개수 분포 상 의미가 없다고 결론지음
>
> 또한 빈도가 높을수록 연관성이 높다고 짠 로직에서 해당 빈도수를 길이에 따라 달리 판단하는 것은 옳지 않다고 판단


<br/>

### <mark>⚠️ 문제점</mark>

상대적 비율의 파라미터로 판단하다 보니 리뷰가 적어 테마 판단이 불가능한 가게 또한 분류됨

흔히 찾는 테마에 정보가 집중됨(연인,가족,가성비)


</details>


<details>
  <summary><h2>📊 테마 분류 결과 분석</summary>

### <mark>🎯 평가용 데이터셋 구축</mark>

**ChatGPT를 활용한 평가용 데이터셋 구축**
> 테마 분류 결과에는 정답이 정해져 있지 않아, __단순 참고 목적으로 서울팟 분류 데이터와 비교할 데이터를 GPT 모델을 활용해서 구축하기로 결정함__
>
> 우리 모델에 적용한 리뷰 데이터(kor_review_text, place_feature), 키워드 사전을 GPT 모델에도 동일하게 적용
> 
> 그외의 분류 알고리즘 및 파라미터 가중치는 개입하지 않고 테마 데이터 라벨링 진행

<br/>

### <mark>💾 비교 과정</mark>
**GPT 모델은 한 가게를 기준으로, 더 많은 테마로 분류를 했기 때문에, 분류 작업이 상대적으로 무의미해보임** 

약 13000개 가게에 대해서 **서울팟 모델의 테마 분류 데이터를 기준으로 GPT 모델의 데이터와의 일치도를 계산**



$$일치도 = \frac{GPT 테마 분류 데이터}{서울팟 테마 분류 데이터} \times 100$$

0 : 불일치한 경우, 

0 ~ 1 : 서울팟 분류 데이터 中 GPT 분류 데이터 포함하는 경우

1 : 완전 일치한 경우


<br/>

### <mark>📃 결과</mark>

**① 일치도 분석**

> 약 13000개 가게를 대상으로,
>
> 일치도가 1.0인 경우는 약 54% (6986개)
>
> 일치도가 0.5인 경우는 약 2% (203개)
>
> 일치도가 0.0인 경우는 약 44% (5694개)
>
> 라는 것을 확인할 수 있다.

**② 일치도가 1.0인 경우 분석**

> 1. 둘다 결측치인 경우 : 78.7 %
> 
> 2. 완전 일치하는 경우 : 4.4 %
> 
> 3. 지피티 분류 데이터 ⊃ 서울팟 분류 데이터 : 16.9 %

![image](https://github.com/user-attachments/assets/1c6e6737-5d49-47a4-989f-437deb5ce6f3)


**③ 일치도가 0.0인 경우 분석**

> 일치도가 0인 5694개 가게 중,
>
> 1. 지피티 분류 데이터만 결측치인 경우 : 40.3 %
> 
> 2. 서울팟 분류 데이터만 결측치인 경우 : 46.2 %
>
> 3. 완전 불일치한 경우 : 13.5 %
![image](https://github.com/user-attachments/assets/d65c05f0-c956-4d4e-9593-dfcee65638de)


<br/>

<details>
<summary><h4>📃 실제 가게 </summary>

> 1. GPT 모델 분류 데이터 : 연인, 혼놀, 인테리어
> 
> 2. 서울팟 모델 분류 데이터 : 혼놀
> 
![image](https://github.com/user-attachments/assets/1640a2fe-fb50-4913-89f8-553caa69789e)

> 1. GPT 모델 분류 데이터 : 가족, 연인, 힐링, 가성비
>
> 2. 서울팟 모델 분류 데이터 : 가성비
>
![image](https://github.com/user-attachments/assets/d4491b43-e194-48a9-9cfb-a9c9cf6341c7)


</details>


</details>
